tmp = apply(abs(cor(S00,S000)),1,max)
apply(abs(cor(S0,res16$S[[1]])),1,which.max)
apply(abs(cor(S0,res24$S[[4]])),1,max)
print( mean(apply(abs(cor(S0,res24$S[[4]])),1,max) ) )
print( mean(apply(abs(cor(S0,res24$S[[3]])),1,max) ) )
mean(apply(abs(cor(S0,res24$S[[3]])),1,max) )
apply(abs(cor(S0,res24$S[[3]])),1,max)
apply(abs(cor(S0,res28$S[[1]])),1,max)
apply(abs(cor(S0,res28$S[[2]])),1,max)
mean(apply(abs(cor(S0,res28$S[[2]])),1,max) )
mean(apply(abs(cor(S0,res28$S[[3]])),1,max) )
mean(apply(abs(cor(S0,res28$S[[4]])),1,max) )
mean(apply(abs(cor(S0,res28$S[[5]])),1,max) )
apply(abs(cor(S0,res28$S[[5]])),1,max)
apply(abs(cor(S0,res16$S[[1]])),1,max)
mean(apply(abs(cor(S0,res16$S[[1]])),1,max) )
mean(apply(abs(cor(S0,res16$S[[2]])),1,max) )
mean(apply(abs(cor(S0,res20$S[[1]])),1,max) )
mean(apply(abs(cor(S0,res20$S[[3]])),1,max) )
mean(apply(abs(cor(S0,res24$S[[1]])),1,max) )
mean(apply(abs(cor(S0,res24$S[[2]])),1,max) )
res16_dic = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res16_dic.rds")
res20_dic = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res20_dic.rds")
res24_dic = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res24_dic.rds")
res28_dic = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res28_dic.rds")
S0 = res20_dic$S[[2]][,c(8,9,14,13)]
apply(abs(cor(S0,res16_dic$S[[1]])),1,max)
mean(apply(abs(cor(S0,res16_dic$S[[1]])),1,max) )
mean(apply(abs(cor(S0,res16_dic$S[[2]])),1,max) )
mean(apply(abs(cor(S0,res20_dic$S[[1]])),1,max) )
mean(apply(abs(cor(S0,res20_dic$S[[3]])),1,max) )
mean(apply(abs(cor(S0,res24_dic$S[[1]])),1,max) )
mean(apply(abs(cor(S0,res24_dic$S[[2]])),1,max) )
mean(apply(abs(cor(S0,res24_dic$S[[3]])),1,max) )
mean(apply(abs(cor(S0,res24_dic$S[[4]])),1,max) )
mean(apply(abs(cor(S0,res28_dic$S[[2]])),1,max) )
mean(apply(abs(cor(S0,res28_dic$S[[3]])),1,max) )
mean(apply(abs(cor(S0,res28_dic$S[[4]])),1,max) )
mean(apply(abs(cor(S0,res28_dic$S[[5]])),1,max) )
cor(S0,net_vec)
dim(net_vec)
dim(S0)
#selection of K and L
#fMRI
reduced_data = readRDS(file="/Users/Ben/Desktop/work2/DICA/2stageNEW/reduced_data601155992510.rds")
dim(reduced_data)
S0 =  res20$S[[2]][,c(11,3,12,6,10,7)]
cor(S0,net_vec)
abs(cor(S0,net_vec))
apply( abs(cor(S0,net_vec)),2,max)
apply( abs(cor(S0,net_vec)),1,max)
S0 =  res20$S[[2]][,c(11,3,12,6,10,7)]
apply( abs(cor(S0,net_vec)),1,max)
S0 = res$S[[3]][,c(11,6,3,2,13,10)]
S0 =  res20$S[[2]][,c(11,3,12,6,10,7)]
apply( abs(cor(S0,net_vec)),1,max)
mean(apply(abs(cor(S0,res28$S[[2]])),1,which.max) )
apply(abs(cor(S0,res28$S[[2]])),1,which.max)
apply( abs(cor(S0,net_vec)),1,which.max)
abs(cor(S0,net_vec))
apply( abs(cor(S0,net_vec)),2,which.max)
S1 = res16$S[[1]]
apply( abs(cor(S0,net_vec)),2,which.max)
apply( abs(cor(S1,net_vec)),2,which.max)
#8 9 8 8 2 6 6 4 3 5
apply( abs(cor(S0,net_vec)),1,max)
#8 9 8 8 2 6 6 4 3 5
apply( abs(cor(S0,net_vec)),1,which.max)
abs(cor(S0,net_vec))
net_vec0 = net_vec[,c(1,3,4,6,7,8)]
#8 9 8 8 2 6 6 4 3 5
apply( abs(cor(S0,net_vec0)),1,which.max)
apply( abs(cor(S0,net_vec0)),2,which.max)
abs(cor(S0,net_vec0))
S1 = res16$S[[1]]
apply( abs(cor(S1,net_vec0)),2,which.max)
out_nii = output_nii(S1,nii,mask,q= 0.95)
fmri_data = list.files(path = "/Users/ben/Desktop/work2/DICA/2stageREVISE/PNC/REST")
i = 1
nii = readNIfTI(paste0(nii_path,fmri_data[i],"/rest_res2standard_2mm.nii.gz") )
#fmri
fmri_path = "/Users/ben/Desktop/work2/DICA/PNC/REST/600039015048/"
source('~/Desktop/dica_realdata_example.R', echo=TRUE)
out_nii = output_nii(S1,nii,mask,q= 0.95)
nii = readNIfTI(paste0(fmri_path,"/rest_res2standard_2mm.nii.gz") )
out_nii = output_nii(S1,nii,mask,q= 0.95)
writeNIfTI(out_nii$out_S,filename = paste0(save_path,'fmrires_test22_1610'))
save_path="/Users/Ben/Desktop/work2/DICA/2stageREVISE/"
writeNIfTI(out_nii$out_S,filename = paste0(save_path,'fmrires_test22_1610'))
out_nii = output_nii(S1,nii,mask,q= 0.8)
writeNIfTI(out_nii$out_S_thr2,filename = paste0(save_path,'fmrires_test22_S3_1610_08'))
apply( abs(cor(S1,net_vec0)),2,which.max)
abs(cor(S1,net_vec0))
S1 = res28$S[[5]]
apply( abs(cor(S1,net_vec0)),2,which.max)
#8 9 8 8 2 6 6 4 3 5
apply( abs(cor(S1,net_vec0)),1,which.max)
abs(cor(S1,net_vec0))
S1 = res28$S[[5]]
out_nii = output_nii(S1,nii,mask,q= 0.95)
writeNIfTI(out_nii$out_S,filename = paste0(save_path,'fmrires_test22_2826'))
writeNIfTI(out_nii$out_S_thr,filename = paste0(save_path,'fmrires_test22_S2_2826'))
writeNIfTI(out_nii$out_S_thr2,filename = paste0(save_path,'fmrires_test22_S3_2826'))
library(mclust)
library(ica)
library(mvtnorm)
library(MCMCpack)
library(gtools)
library(lattice)
library(gplots)
#fMRI
library(neurobase)
library(oro.nifti)
library(R.matlab)
#load functions
#source("/path/to/dica_fun.R")
source("/Users/ben/Desktop/work2/DICA/2stageREVISE/dica_fun.R")
res16 = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res16.rds")
res20 = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res20.rds")
res24 = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res24.rds")
res28 = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res28.rds")
S0 =  res20$S[[2]][,c(11,3,12,6,10,7)]
S1 = res28$S[[1]]
mean(apply(abs(cor(S0,res28$S[[1]])),1,max) )
res16_dic = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res16_dic.rds")
res20_dic = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res20_dic.rds")
res24_dic = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res24_dic.rds")
res28_dic = readRDS(file = "/Users/Ben/Desktop/work2/DICA/2stageREVISE/res28_dic.rds")
S0 = res20_dic$S[[2]][,c(8,9,14,13)]
mean(apply(abs(cor(S0,res28_dic$S[[5]])),1,max) )
mean(apply(abs(cor(S0,res28_dic$S[[1]])),1,max) )
apply(abs(cor(S0,res28_dic$S[[1]])),1,max)
?DICA
library(DICA)
?DICA
?DICA::dica
install.packages("/Users/ben/desktop/tmp/MaAggre_0.0.0.9000.tar.gz",repos=NULL)
library(MaAggre)
?MaAggre
install.packages("/Users/ben/desktop/tmp/VisSLNN_0.0.0.9000.tar.gz",repos=NULL)
library("Rtsne")
install.packages("Rtsne")
install.packages("/Users/ben/desktop/tmp/VisSLNN_0.0.0.9000.tar.gz",repos=NULL)
VisSLNN::torch_triplet_margin_miner()
?VisSLNN::torch_triplet_margin_miner()
?VisSLNN::classification_net
?VisSLNN
1^0
0^0
1^1
0^1
library(neurobase)
write_path = "/Users/Ben/Desktop/work2/DICA/tmp/"
#fmri
fmri_path = "/Users/ben/Desktop/work2/DICA/PNC/REST/600039015048/"
mask_path = "/Users/ben/Desktop/work2/DICA/600085654611/"
nii = readNIfTI(paste0(fmri_path,"/rest_res2standard_2mm.nii.gz") )
dim(nii)
image(nii[,,,1])
image(nii[1,,,1])
image(nii[,,1,1])
image(nii[,,,1],z=30,plot.type="single")
image(nii,z=30,plot.type="single")
table(mask)
mask = readNIfTI(paste0(mask_path,"GRAY.nii") )
table(mask)
tmp  = nii[mask==1,1]
dim(mask)
tmp1 = nii[,,,1]
tmp  = tmp1[mask==1]
sd(tmp)
tmp1 = nii[,,,2]
tmp  = tmp1[mask==1]
for(i in 1:120){
tmp1 = nii[,,,i]
tmp  = tmp1[mask==1]
sd(tmp)
}
for(i in 1:120){
tmp1 = nii[,,,i]
tmp  = tmp1[mask==1]
print( sd(tmp) )
}
sd0 = rep(0,120)
for(i in 1:120){
tmp1 = nii[,,,i]
tmp  = tmp1[mask==1]
sd0[i] =  sd(tmp)
}
sd0
mean(sd0)
tmp1[mask==0]
hist(tmp1[mask==0])
dim(nii)
noise = 10*rnorm(91*109*91*120)
dim(noise)
dim(noise) = c(91,109,91,120)
nii0 = nii + noise
for(i in 1:120){
nii0[mask==0,i] = NaN
}
for(i in 1:120){
nii0[mask==0,i] =NA
}
for(i in 1:120){
nii0[mask==0,i] = array(NA,dim=c(91,109,91))
}
sum(mask==0)
sum(mask==1)
for(i in 1:120){
nii0[mask==0,i] = rep(NA,656509)
}
for(i in 1:120){
tmp = nii0[,,,i]
tmp[mask0==0] = NA
nii0[,,,i] = tmp
}
for(i in 1:120){
tmp = nii0[,,,i]
tmp[mask==0] = NA
nii0[,,,i] = tmp
}
nii0[,,,1]
tmp =  nii0[,,,1]
tmp[mask==0]
which(is.na(tmp[mask==1]))
which(is.na(tmp[mask==0]))
sum(is.na(tmp[mask==0]))
mask0 = 1 - is.na(nii0[,,,1])
sum(mask0[mask==1] - mask[mask==1])
sum( abs(mask0[mask==1] - mask[mask==1]) )
sum( abs(mask0[mask==0] - mask[mask==0]) )
copyNIfTIHeader(img = nii, arr = nii0)
(1-1/10000)^6
class(nii0)
writeNIfTI(nii0,filename = "/Users/ben/Desktop/Rpackage/nii0")
nii1  = readNIfTI("/Users/ben/Desktop/Rpackage/nii0.nii.gz")
mask0 = 1 - is.na(nii1[,,,1])
table(mask0)
reduced_data = prepfmri(nii1,mask0,40)
library(DICA)
reduced_data = prepfmri(nii1,mask0,40)
res_fmri = dica(reduced_data,K = 20,L =14)
write_ics(res_fmri$S,nii,mask, q = 0.95, paste0(write_path,"test_fmri"))
nii = readNIfTI(paste0(fmri_path,"/rest_res2standard_2mm.nii.gz") )
mask = readNIfTI(paste0(mask_path,"GRAY.nii") )
noise = 5*rnorm(91*109*91*120)
dim(noise) = c(91,109,91,120)
nii0 = nii + noise
for(i in 1:120){
tmp = nii0[,,,i]
tmp[mask==0] = NA
nii0[,,,i] = tmp
}
tmp =  nii0[,,,1]
sum(is.na(tmp[mask==0]))
copyNIfTIHeader(img = nii, arr = nii0)
nii0 = nii0[,,,21:90]
copyNIfTIHeader(img = nii, arr = nii0)
nii0 = nii0[,,,21:80]
nii0 = nii0[,,,1:60]
copyNIfTIHeader(img = nii, arr = nii0)
writeNIfTI(nii0,filename = "/Users/ben/Desktop/Rpackage/nii0")
nii1  = readNIfTI("/Users/ben/Desktop/Rpackage/nii0.nii.gz")
mask0 = 1 - is.na(nii1[,,,1])
reduced_data = prepfmri(nii1,mask0,40)
res_fmri = dica(reduced_data,K = 20,L =14)
write_ics(res_fmri$S,nii,mask, q = 0.95, paste0(write_path,"test_fmri"))
#dti
dti_path = "/Users/Ben/Desktop/work2/DICA/600085654611/"
L_1 = readNIfTI(paste0(dti_path, "data_L1.nii.gz") )
L_2 = readNIfTI(paste0(dti_path, "data_L2.nii.gz") )
L_3 = readNIfTI(paste0(dti_path, "data_L3.nii.gz") )
V_1 = readNIfTI(paste0(dti_path, "data_V1.nii.gz") )
V_2 = readNIfTI(paste0(dti_path, "data_V2.nii.gz") )
V_3 = readNIfTI(paste0(dti_path, "data_V3.nii.gz") )
dim(L_1)
dim(L_2)
dim(L_3)
sd( L_1[L_1>0] )
sd( L_2[L_1>0] )
sd( L_3[L_1>0] )
L_1[L_1>0]
L_1[L_1>0] - L_2[L_1>0]
max(L_1[L_1>0] - L_2[L_1>0])
min(L_1[L_1>0] - L_2[L_1>0])
V_1[L_1>0]
V_1[1]
V_1[2]
L_1>0
V_1[L_1>0]
tmp1 = V_1[L_1>0]
tmp2 = V_2[L_1>0]
tmp3 = V_3[L_1>0]
tmp1[1]
tmp2[1]
tmp3[1]
tmp1[1]^2 + tmp2[1]^2 + tmp3[1]^2
library(neurobase)
library(DICA)
dti_path = "/Users/Ben/Desktop/work2/DICA/600085654611/"
L_1 = readNIfTI(paste0(dti_path, "data_L1.nii.gz") )
L_2 = readNIfTI(paste0(dti_path, "data_L2.nii.gz") )
L_3 = readNIfTI(paste0(dti_path, "data_L3.nii.gz") )
V_1 = readNIfTI(paste0(dti_path, "data_V1.nii.gz") )
V_2 = readNIfTI(paste0(dti_path, "data_V2.nii.gz") )
V_3 = readNIfTI(paste0(dti_path, "data_V3.nii.gz") )
tmp1 = L_1[L_1>0]
class(tmp1)
n = length(tmp1)
n
sd(tmp1)
sd0 = sd(tmp1)
tmp1 = tmp1 + tmp1*0.5* rnorm(n)
min(L_1[L_1>0]-L_2[L_1>0])
tmp2 = L_2[L_1>0]
for(i in 1:n){
if(tmp1[i] < tmp2[i]){
tmp1[i] = tmp2[i] + 1e-6
}
}
min(L_2[L_1>0]-L_3[L_1>0])
tmp1 = L_1[L_1>0]
tmp2 = L_2[L_1>0]
tmp3 = L_3[L_1>0]
n = length(tmp1)
tmp1 = tmp1 + tmp1*0.05* rnorm(n)
tmp2 = tmp2 + tmp2*0.05* rnorm(n)
tmp3 = tmp3 + tmp3*0.05* rnorm(n)
for(i in 1:n){
if(tmp2[i] < tmp3[i]){
tmp2[i] = tmp3[i] + 1e-7
}
if(tmp1[i] < tmp2[i]){
tmp1[i] = tmp2[i] + 1e-7
}
}
L_1_0 = L_1
L_2_0 = L_2
L_3_0 = L_3
is.na(L_1)
sum(is.na(L_1))
sum((L_1==0))
sum((L_1!=0))
length(L_1)
L_1_0[L_1>0] = tmp1
L_2_0[L_1>0] = tmp2
L_3_0[L_1>0] = tmp3
dim(L_1_0)
writeNIfTI(L_1_0,filename = "/Users/ben/Desktop/Rpackage/L1")
writeNIfTI(L_2_0,filename = "/Users/ben/Desktop/Rpackage/L2")
writeNIfTI(L_3_0,filename = "/Users/ben/Desktop/Rpackage/L3")
writeNIfTI(V_1_0,filename = "/Users/ben/Desktop/Rpackage/V1")
writeNIfTI(V_2_0,filename = "/Users/ben/Desktop/Rpackage/V2")
writeNIfTI(V_3_0,filename = "/Users/ben/Desktop/Rpackage/V3")
V_1_0 = V_1
V_2_0 = V_2
V_3_0 = V_3
copyNIfTIHeader(img = L_1, arr = L_1_0)
copyNIfTIHeader(img = L_1, arr = L_2_0)
copyNIfTIHeader(img = L_1, arr = L_3_0)
copyNIfTIHeader(img = L_1, arr = V_1_0)
copyNIfTIHeader(img = L_1, arr = V_2_0)
copyNIfTIHeader(img = L_1, arr = V_3_0)
writeNIfTI(L_1_0,filename = "/Users/ben/Desktop/Rpackage/L1")
writeNIfTI(L_2_0,filename = "/Users/ben/Desktop/Rpackage/L2")
writeNIfTI(L_3_0,filename = "/Users/ben/Desktop/Rpackage/L3")
writeNIfTI(V_1_0,filename = "/Users/ben/Desktop/Rpackage/V1")
writeNIfTI(V_2_0,filename = "/Users/ben/Desktop/Rpackage/V2")
writeNIfTI(V_3_0,filename = "/Users/ben/Desktop/Rpackage/V3")
L_1 = readNIfTI("/Users/ben/Desktop/Rpackage/L1.nii.gz")
L_1 = readNIfTI("/Users/ben/Desktop/Rpackage/L1.nii.gz")
L_2 = readNIfTI("/Users/ben/Desktop/Rpackage/L2.nii.gz")
L_3 = readNIfTI("/Users/ben/Desktop/Rpackage/L3.nii.gz")
V_1 = readNIfTI("/Users/ben/Desktop/Rpackage/V1.nii.gz")
V_2 = readNIfTI("/Users/ben/Desktop/Rpackage/V2.nii.gz")
V_3 = readNIfTI("/Users/ben/Desktop/Rpackage/V3.nii.gz")
data0 = get_dti(V_1,V_2,V_3,L_1,L_2,L_3)
res_dti = dica(data0$X,K = 20,L =14,tol = 1e-3)
write_ics(res_dti$S,L_1,(L_1!=0), q = 0.95, paste0(write_path,"test_dti"))
write_path = "/Users/Ben/Desktop/work2/DICA/tmp/"
write_ics(res_dti$S,L_1,(L_1!=0), q = 0.95, paste0(write_path,"test_dti"))
#dti
dti_path = "/Users/Ben/Desktop/work2/DICA/600085654611/"
L_1 = readNIfTI(paste0(dti_path, "data_L1.nii.gz") )
L_2 = readNIfTI(paste0(dti_path, "data_L2.nii.gz") )
L_3 = readNIfTI(paste0(dti_path, "data_L3.nii.gz") )
V_1 = readNIfTI(paste0(dti_path, "data_V1.nii.gz") )
V_2 = readNIfTI(paste0(dti_path, "data_V2.nii.gz") )
V_3 = readNIfTI(paste0(dti_path, "data_V3.nii.gz") )
tmp1 = L_1[L_1>0]
tmp2 = L_2[L_1>0]
tmp3 = L_3[L_1>0]
n = length(tmp1)
tmp1 = tmp1 + tmp1*0.03* rnorm(n)
tmp2 = tmp2 + tmp2*0.02* rnorm(n)
tmp3 = tmp3 + tmp3*0.02* rnorm(n)
for(i in 1:n){
if(tmp2[i] < tmp3[i]){
tmp2[i] = tmp3[i] + 1e-7
}
if(tmp1[i] < tmp2[i]){
tmp1[i] = tmp2[i] + 1e-7
}
}
L_1_0 = L_1
L_2_0 = L_2
L_3_0 = L_3
L_1_0[L_1>0] = tmp1
L_2_0[L_1>0] = tmp2
L_3_0[L_1>0] = tmp3
V_1_0 = V_1
V_2_0 = V_2
V_3_0 = V_3
copyNIfTIHeader(img = L_1, arr = L_1_0)
copyNIfTIHeader(img = L_1, arr = L_2_0)
copyNIfTIHeader(img = L_1, arr = L_3_0)
copyNIfTIHeader(img = L_1, arr = V_1_0)
copyNIfTIHeader(img = L_1, arr = V_2_0)
copyNIfTIHeader(img = L_1, arr = V_3_0)
writeNIfTI(L_1_0,filename = "/Users/ben/Desktop/Rpackage/L1")
writeNIfTI(L_2_0,filename = "/Users/ben/Desktop/Rpackage/L2")
writeNIfTI(L_3_0,filename = "/Users/ben/Desktop/Rpackage/L3")
writeNIfTI(V_1_0,filename = "/Users/ben/Desktop/Rpackage/V1")
writeNIfTI(V_2_0,filename = "/Users/ben/Desktop/Rpackage/V2")
writeNIfTI(V_3_0,filename = "/Users/ben/Desktop/Rpackage/V3")
L_1 = readNIfTI("/Users/ben/Desktop/Rpackage/L1.nii.gz")
L_2 = readNIfTI("/Users/ben/Desktop/Rpackage/L2.nii.gz")
L_3 = readNIfTI("/Users/ben/Desktop/Rpackage/L3.nii.gz")
V_1 = readNIfTI("/Users/ben/Desktop/Rpackage/V1.nii.gz")
V_2 = readNIfTI("/Users/ben/Desktop/Rpackage/V2.nii.gz")
V_3 = readNIfTI("/Users/ben/Desktop/Rpackage/V3.nii.gz")
data0 = get_dti(V_1,V_2,V_3,L_1,L_2,L_3)
res_dti = dica(data0$X,K = 20,L =14,tol = 1e-3)
write_ics(res_dti$S,L_1,(L_1!=0), q = 0.95, paste0(write_path,"test_dti"))
system.file("L_1.nii.gz",package="DICA")
library(DICA)
system.file("L_1.nii.gz",package="DICA")
system.file("","L_1.nii.gz",package="DICA")
system.file("inst","L_1.nii.gz",package="DICA")
system.file("extdata","L_1.nii.gz",package="DICA")
library(DICA)
system.file("extdata","L_1.nii.gz",package="DICA")
system.file("extdata","L1.nii.gz",package="DICA")
system.file("extdata",package="DICA")
system.file("extdata","*nii.gz",package="DICA")
system.file("extdata","*.nii.gz",package="DICA")
fmridata = readNIfTI(system.file("extdata","ex_fmri.nii.gz",package="DICA") )
library(DICA)
fmridata = readNIfTI(system.file("extdata","ex_fmri.nii.gz",package="DICA") )
fmridata = neurobase::readNIfTI(system.file("extdata","ex_fmri.nii.gz",package="DICA") )
fmridata = oro.nifti::readNIfTI(system.file("extdata","ex_fmri.nii.gz",package="DICA") )
library(DICA)
data_path = system.file("extdata",package="DICA")
data_path
``` r
fmridata = oro.nifti::readNIfTI(paste0(data_path,"fmri.nii.gz")
mask = 1 - is.na(fmridata[,,,1])
``` r
fmridata = oro.nifti::readNIfTI(paste0(data_path,"fmri.nii.gz"))
mask = 1 - is.na(fmridata[,,,1])
paste0(data_path,"fmri.nii.gz")
``` r
fmridata = oro.nifti::readNIfTI(paste0(data_path,"/fmri.nii.gz"))
mask = 1 - is.na(fmridata[,,,1])
fmridata = oro.nifti::readNIfTI(paste0(data_path,"/fmri.nii.gz"))
fmridata = oro.nifti::readNIfTI(paste0(data_path,"/fmri.nii.gz"))
mask = 1 - is.na(fmridata[,,,1])
prep_data = prepfmri(fmridata,mask,40)
res_fmri = dica(prep_data,K = 20,L =14)
library(DICA)
nii = readNIfTI(paste0(fmri_path,"/rest_res2standard_2mm.nii.gz") )
#fmri
fmri_path = "/Users/ben/Desktop/work2/DICA/PNC/REST/600039015048/"
mask_path = "/Users/ben/Desktop/work2/DICA/600085654611/"
nii = readNIfTI(paste0(fmri_path,"/rest_res2standard_2mm.nii.gz") )
noise = 5*rnorm(91*109*91*120)
dim(noise) = c(91,109,91,120)
nii0 = nii + noise
for(i in 1:120){
tmp = nii0[,,,i]
tmp[mask==0] = NA
nii0[,,,i] = tmp
}
tmp =  nii0[,,,1]
sum(is.na(tmp[mask==0]))
nii0 = nii0[,,,1:50]
copyNIfTIHeader(img = nii, arr = nii0)
writeNIfTI(nii0,filename = "/Users/ben/Desktop/Rpackage/nii0")
library(neurobase)
library(DICA)
write_path = "/Users/Ben/Desktop/work2/DICA/tmp/"
fmri_path = "/Users/ben/Desktop/work2/DICA/PNC/REST/600039015048/"
mask_path = "/Users/ben/Desktop/work2/DICA/600085654611/"
nii = readNIfTI(paste0(fmri_path,"/rest_res2standard_2mm.nii.gz") )
mask = readNIfTI(paste0(mask_path,"GRAY.nii") )
noise = 5*rnorm(91*109*91*120)
dim(noise) = c(91,109,91,120)
nii0 = nii + noise
for(i in 1:120){
tmp = nii0[,,,i]
tmp[mask==0] = NA
nii0[,,,i] = tmp
}
tmp =  nii0[,,,1]
sum(is.na(tmp[mask==0]))
nii0 = nii0[,,,1:50]
copyNIfTIHeader(img = nii, arr = nii0)
writeNIfTI(nii0,filename = "/Users/ben/Desktop/Rpackage/nii0")
nii0 = nii0[,,,1:45]
copyNIfTIHeader(img = nii, arr = nii0)
writeNIfTI(nii0,filename = "/Users/ben/Desktop/Rpackage/nii0")
